<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>历史记录 - 卡路里基站</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 导航栏样式 */
        .header {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #2e8b57;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 20px;
        }
        
        .nav-links li a {
            text-decoration: none;
            color: #333;
            padding: 10px 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-links li a:hover,
        .nav-links li a.active {
            color: #2e8b57;
            background-color: rgba(46, 139, 87, 0.1);
        }
        
        /* 区块样式 */
        .section {
            padding: 80px 0;
        }
        
        .section-title {
            font-size: 36px;
            color: #2e8b57;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .section-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
            text-align: center;
        }
        
        /* 主内容区域 */
        .main-content {
            padding-top: 120px;
            min-height: 100vh;
            padding-bottom: 60px;
        }
        
        /* 表格容器 */
        .table-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 50px;
            overflow-x: auto;
        }
        
        .table-header {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        
        .data-table th {
            background-color: #e8f5e8;
            color: #2e8b57;
            padding: 15px;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        /* 日期分组样式 */
        .date-group {
            margin-bottom: 30px;
        }
        
        .date-header {
            font-size: 18px;
            color: #2196f3;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e3f2fd;
        }
        
        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state p {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .btn-primary {
            display: inline-block;
            background-color: #2e8b57;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #24724e;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }
        
        /* 返回健康追踪按钮 */
        .back-button {
            margin-bottom: 20px;
            display: inline-block;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .table-container {
                padding: 20px;
            }
            
            .data-table th,
            .data-table td {
                padding: 10px 8px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 576px) {
            .navbar {
                flex-direction: column;
                padding: 10px 0;
            }
            
            .logo {
                margin-bottom: 10px;
            }
            
            .nav-links li {
                margin-left: 10px;
                margin-right: 10px;
            }
            
            .main-content {
                padding-top: 150px;
            }
        }
        
        /* 底部样式 */
        .footer {
            background-color: #333;
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-logo {
            font-size: 20px;
            font-weight: bold;
        }
        
        .footer-links {
            display: flex;
            list-style: none;
        }
        
        .footer-links li {
            margin-left: 20px;
        }
        
        .footer-links li a {
            color: white;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links li a:hover {
            color: #2e8b57;
        }
        
        .copyright {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #999;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo">卡路里基站 Calorie Station</a>
                <ul class="nav-links">
                    <li><a href="index.html">首页</a></li>
                    <li><a href="cooking-assistant.html">烹饪助手</a></li>
                    <li><a href="recipe-recommend.html">菜谱推荐</a></li>
                    <li><a href="health-tracking.html" class="active">健康追踪</a></li>
                    <li><a href="dish-recognition.html">原材料识别</a></li>
                    <li><a href="nutrition-knowledge.html">营养科普</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="container">
            <h1 class="section-title">历史记录</h1>
            <p class="section-subtitle">查看过往每天的营养摄入情况</p>
            
            <div class="table-container">
                <a href="health-tracking.html" class="btn-primary back-button">返回健康追踪</a>
                
                <!-- 历史记录表格将按日期分组显示 -->
                <div id="history-records-container">
                </div>
            </div>
        </div>
    </main>
    
    <!-- 底部 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">卡路里基站 Calorie Station</div>
                <ul class="footer-links">
                    <li><a href="index.html">首页</a></li>
                    <li><a href="nutrition-knowledge.html">营养科普</a></li>
                    <li><a href="health-tracking.html">健康追踪</a></li>
                </ul>
            </div>
            <div class="copyright">© 2025 卡路里基站 版权所有</div>
        </div>
    </footer>
    
    <script>
        // 获取今日日期
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // 加载历史记录
        function loadHistoryRecords() {
            const container = document.getElementById('history-records-container');
            const keys = Object.keys(localStorage);
            const recordKeys = keys.filter(key => key.startsWith('foodRecords_'));
            
            // 清空容器
            container.innerHTML = '';
            
            // 如果没有历史记录，显示空状态
            if (recordKeys.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>暂无历史记录</p>
                        <p>开始记录您的饮食，查看详细的营养摄入历史</p>
                    </div>
                `;
                return;
            }
            
            // 按日期排序，最新的在前
            recordKeys.sort((a, b) => {
                const dateA = a.replace('foodRecords_', '');
                const dateB = b.replace('foodRecords_', '');
                return new Date(dateB) - new Date(dateA);
            });
            
            // 遍历每一天的记录
            recordKeys.forEach(key => {
                const date = key.replace('foodRecords_', '');
                // 跳过今天的记录，今天的记录在health-tracking.html中显示
                if (date === getTodayDate()) {
                    return;
                }
                
                const recordsJSON = localStorage.getItem(key);
                if (!recordsJSON) return;
                
                try {
                    const records = JSON.parse(recordsJSON);
                    if (!records || records.length === 0) return;
                    
                    // 创建日期分组
                    const dateGroup = document.createElement('div');
                    dateGroup.className = 'date-group';
                    
                    // 添加日期标题
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-header';
                    dateHeader.textContent = formatDate(date);
                    dateGroup.appendChild(dateHeader);
                    
                    // 创建表格
                    const table = document.createElement('table');
                    table.className = 'data-table';
                    
                    // 创建表头
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th>菜品名称</th>
                            <th>重量（g）</th>
                            <th>热量（kcal）</th>
                            <th>碳水（g）</th>
                            <th>蛋白质（g）</th>
                            <th>脂肪（g）</th>
                            <th>膳食纤维（g）</th>
                            <th>矿物质（mg）</th>
                            <th>维生素（mg）</th>
                            <th>时间</th>
                            <th>备注</th>
                        </tr>
                    `;
                    table.appendChild(thead);
                    
                    // 创建表格主体
                    const tbody = document.createElement('tbody');
                    
                    // 添加每条记录
                    records.forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${record.name || '-'}</td>
                            <td>${record.weight || '-'}</td>
                            <td>${record.calories || '-'}</td>
                            <td>${record.carb !== undefined ? record.carb : '-'}</td>
                            <td>${record.protein !== undefined ? record.protein : '-'}</td>
                            <td>${record.fat !== undefined ? record.fat : '-'}</td>
                            <td>${record.fiber !== undefined ? record.fiber : '-'}</td>
                            <td>${record.mineral !== undefined ? record.mineral : '-'}</td>
                            <td>${record.vitamin !== undefined ? record.vitamin : '-'}</td>
                            <td>${record.time || '-'}</td>
                            <td>${record.notes || '-'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    table.appendChild(tbody);
                    dateGroup.appendChild(table);
                    container.appendChild(dateGroup);
                    
                } catch (error) {
                    console.error(`解析日期 ${date} 的记录时出错:`, error);
                }
            });
        }
        
        // 格式化日期显示
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekDays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
            const weekDay = weekDays[date.getDay()];
            return `${year}年${month}月${day}日 ${weekDay}`;
        }
        
        // 页面加载时加载历史记录
        document.addEventListener('DOMContentLoaded', function() {
            loadHistoryRecords();
        });
    </script>
</body>
</html>